[< Volver al Ã­ndice](../index.md)

# Activate the Comment Form

En este episodio se le agrega funcionalidad al boton de crear post, para ello hacemos lo siguiente:

- Creamos un nuevo controller llamado *PostCommentsController* con el comando `php artisan make:controller PostCommentsController` y agregamos el siguiente codigo:

```php
<?php

namespace App\Http\Controllers;

use App\Models\Post;
use Illuminate\Http\Request;

class PostCommentsController extends Controller
{
    public function store(Post $post)
    {
        request()->validate([
            'body' => 'required'
        ]);

        $post->comments()->create([
            'user_id' => request()->user()->id,
            'body' => request('body')
        ]);

        return back();
    }
}
```

- Luego agregamos la ruta en el archivo *web.php*:

```php
Route::post('posts/{post:slug}/comments', [PostCommentsController::class, 'store']);
```

Y limpiamos la cache con los comandos `php artisan route:clear` y `php artisan route:cache`

- Luego modificamos el codigo de *post-comment.blade.php* para cambiar el formato de la fecha del comentario y dejar fijo un avatar para el usuario loggeado:

```php

<x-panel class="bg-gray-50">
    <article class="flex space-x-4">
        <div class="flex-shrink-0">
            <img src="https://i.pravatar.cc/60?u={{ $comment->user_id }}" alt="" width="60" height="60" class="rounded-xl">
        </div>

        <div>
            <header class="mb-4">
                <h3 class="font-bold">{{ $comment->author->username }}</h3>

                <p class="text-xs">
                    Posted
                    <time>{{ $comment->created_at->format('F j, Y, g:i a') }}</time>
                </p>
            </header>

            <p>
                {{ $comment->body }}
            </p>
        </div>
    </article>
</x-panel>
```

- Finalmente se modifica el archivo *show.blade.php* para que solamente muestre el form de crear comentario si hay un usuario loggeado, de lo contrario brinda los links para registrarse o hacer log in:

```php
@auth
    <x-panel>
        <form method="POST" action="/posts/{{$post->slug}}/comments">
            @csrf

            <header class = "flex items-center">
                <img src="https://i.pravatar.cc/60?u={{ auth()->id() }}" alt="" width="40" height="60" class="rounded-full">
                <h2 class="ml-4">Want to participate?</h2>
            </header>

            <div class="mt-6">
                <textarea
                name="body"
                class="w-full text-sm focus:outline-none focus:ring"
                rows="5"
                placeholder="Quick, think on something to say"></textarea>
            </div>

            <div class="flex justify-end mt-6 pt-6 border-t border-gray-200">
                <button type="submit"
                        class="bg-blue-500 text-white uppercase font-semibold text-xs py-2 px-10 rounded-2xl hover:bg-blue-600">
                        POST
                </button>
            </div>
        </form>
    </x-panel>

    @else
        <p>
            <a href="/register"> Register</a> or <a href="/login"> log in </a>to leave a comment.
        </p>

@endauth
```


