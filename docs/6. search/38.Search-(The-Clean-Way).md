[< Volver al Ã­ndice](../index.md)

# Search (The Clean Way)

Para hacer la barra de busqueda de una mejor manera se siguen los siguientes pasos:

```bash
cd /vagrant/sites/lfts.isw811.xyz
php artisan make:controller PostController
```
Y este nuevo archivo Controller es creado en la ruta `app/Http/Controllers`, y lo modificamos con el siguiente codigo:

```php
class PostController extends Controller
{
    public function index()
    {
        return view('posts', [
            'posts' => Post::latest()->filter(request(['search']))->get(),
            'categories' => Category::all()
        ]);
    }

    public function show(Post $post)
    {
        return view('post', [
            'post' => $post
        ]);
    }
}
```
- Luego modificamos nuestro archivo `Post.php` y agregamos una funcion que va a permitir filtrar los resultados que cumplan los parametros indicados en el request:

```php
public function scopeFilter($query, array $filters)
    {
        $query->when($filters['search'] ?? false, fn($query, $search) =>
            $query
                ->where('title', 'like', '%' . $search . '%')
                ->orWhere('body', 'like', '%' . $search . '%'));
    }
```

- En el archivo `web.php` agregamos el controller creado e indicamos las funciones como corresponden para las rutas de ***home*** y ***posts*** por lo que modificamos el codigo incluido en estas de la siguiente manera:

```php
Route::get('/', [PostController::class, 'index'])->name('home');

Route::get('/posts/{post:slug}', [PostController::class, 'show']);
```
